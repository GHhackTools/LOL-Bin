## Web Server Case

[Challenge 1](https://www.ashemery.com/dfir.html) from ashmery[.]com 

**Challenge Files**
 - Disk Image
 - Memory Image
 - Hashed
 - Passwords

**Questions**
1.  What type of attacks has been performed on the box?
2.  How many users has the attacker(s) added to the box, and how were they added?
3.  What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldnâ€™t clean and cover their tracks)
4.  What software has been installed on the box, and were they installed by the attacker(s) or not?
5.  Using memory forensics, can you identify the type of shellcode used?
6.  What is the timeline analysis for all events that happened on the box?
7.  What is your hypothesis for the case, and what is your approach in solving it?
8.  Is there anything else you would like to add?

**Mounting Disk Image**
I used OSFMount from OS Forensics on Windows for GUI 

On SIFT Workstation
```
root@siftworkstation -> /c/Web Server Case
# mmls s4a-challenge4
DOS Partition Table
Offset Sector: 0
Units are in 512-byte sectors

      Slot      Start        End          Length       Description
000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
001:  -------   0000000000   0000002047   0000002048   Unallocated
002:  000:000   0000002048   0052426751   0052424704   NTFS / exFAT (0x07)
003:  -------   0052426752   0052428799   0000002048   Unallocated

root@siftworkstation -> /c/Web Server Case
# mkdir /mnt/Web_Server_Case

root@siftworkstation -> /c/Web Server Case
# mount -o ro,loop,show_sys_files,streams_interface=windows,offset=1048576 s4a-challenge4 /mnt/Web_Server_Case/

root@siftworkstation -> /c/Web Server Case
# ls /mnt/Web_Server_Case/
$AttrDef                eula.1028.txt  globdata.ini          install.res.1042.dll  $Secure
autoexec.bat            eula.1031.txt  inetpub               install.res.2052.dll  System Volume Information
$BadClus                eula.1033.txt  install.exe           install.res.3082.dll  $UpCase
$Bitmap                 eula.1036.txt  install.ini           $LogFile              Users
Boot                    eula.1040.txt  install.res.1028.dll  $MFTMirr              VC_RED.cab
$Boot                   eula.1041.txt  install.res.1031.dll  pagefile.sys          vcredist.bmp
bootmgr                 eula.1042.txt  install.res.1033.dll  PerfLogs              VC_RED.MSI
BOOTSECT.BAK            eula.2052.txt  install.res.1036.dll  ProgramData           $Volume
config.sys              eula.3082.txt  install.res.1040.dll  Program Files         Windows
```

**Gathering System Information**

Unlike *CFReDs Hacking Case & Data Leakage*, this challenge is not asking for specific questions about system information. So, I decided to use this windows batch script from [JourneyIntoIR](https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/jiir-resources/regripper-general-os-info.bat)

*Notes : You may need to install Parse::Win32Registry perl module if you used rip.pl on Windows machine* 
```
#System Hives
Windows/System32/config

#User Hives
Users/<username>/NTUSER.DAT
```
Information Result
```
========================================================================================================= 
General Operating System Information 
========================================================================================================= 
 
winnt_cv v.20161123
(Software) Get & display the contents of the Windows NT\CurrentVersion key

WinNT_CV
Microsoft\Windows NT\CurrentVersion
LastWrite Time Sun Aug 23 21:52:02 2015 (UTC)

  RegisteredOrganization : 
  CurrentVersion : 6.0
  CurrentBuildNumber : 6001
  CurrentBuild : 6001
  CSDBuildNumber : 1616
  SoftwareType : System
  SystemRoot : C:\Windows
  PathName : C:\Windows
  RegisteredOwner : Windows User
  EditionID : ServerStandard
  CSDVersion : Service Pack 1
  CurrentType : Multiprocessor Free
  ProductId : 92573-029-0000095-76373
  BuildLab : 6001.longhorn_rtm.080118-1840
  InstallDate : Mon Aug 24 06:52:43 2015 (UTC)
  ProductName : Windows Server (R) 2008 Standard
  BuildGUID : 28f47544-6618-4bc4-a11e-ed7d7d66e144
  BuildLabEx : 6001.18000.x86fre.longhorn_rtm.080118-1840
  DigitalProductId : a4 00 00 00 03 00 00 00 39 32 35 37 33 2d 30 32 39 2d 30 30 30 30 30 39 35 2d 37 36 34 32 39 00 98 00 00 00 58 31 34 2d 31 39 37 30 39 00 00 00 00 00 00 00 94 21 da ca 46 d0 8e ea c5 13 16 e3 0b d4 05 00 00 00 00 00 06 6f 91 47 fd ca be 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 56 55 1a 77 
  DigitalProductId4 : f8 04 00 00 04 00 00 00 39 00 32 00 35 00 37 00 33 00 2d 00 30 00 30 00 31 00 35 00 32 00 2d 00 30 00 32 00 39 00 2d 00 30 00 30 00 30 00 30 00 30 00 39 00 2d 00 30 00 30 00 2d 00 31 00 30 00 33 00 33 00 2d 00 36 00 30 00 30 00 31 00 2e 00 30 00 30 00 30 00 30 00 2d 00 30 00 31 00 39 00 32 00 30 00 30 00 38 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 36 00 30 00 33 00 35 00 30 00 34 00 66 00 39 00 2d 00 31 00 30 00 39 00 66 00 2d 00 34 00 39 00 66 00 30 00 2d 00 39 00 32 00 37 00 31 00 2d 00 38 00 63 00 36 00 36 00 66 00 37 00 38 00 37 00 38 00 66 00 35 00 38 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 53 00 65 00 72 00 76 00 65 00 72 00 53 00 74 00 61 00 6e 00 64 00 61 00 72 00 64 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 94 21 da ca 46 d0 8e ea c5 13 16 e3 0b d4 05 00 a7 1c 22 cd 05 f8 5e 22 52 86 fd 9b e2 8b 79 62 b7 34 89 91 92 be 69 18 30 b0 a6 82 2c cc d5 f6 16 fa 60 39 d8 66 79 c2 1a c0 ec 6a 78 a8 6a 5f f0 71 64 06 4a c5 f5 39 f5 28 d6 2d 33 05 a4 37 58 00 31 00 34 00 2d 00 31 00 39 00 37 00 30 00 39 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 52 00 65 00 74 00 61 00 69 00 6c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 52 00 65 00 74 00 61 00 69 00 6c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
......................................................................................................... 
 
polacdms v.20100531
(Security) Get local machine SID from Security hive

PolAcDmS
Policy\PolAcDmS
LastWrite Time Mon Aug 24 06:50:38 2015 (UTC)

Machine SID: S-1-5-21-3848053756-3249532031-1848221756

PolPrDmS
Policy\PolPrDmS
LastWrite Time Sat Jan 19 11:35:33 2008 (UTC)

Primary Domain SID: S-1-5-
......................................................................................................... 
 
shutdown v.20080324
(System) Gets ShutdownTime value from System hive

ControlSet001\Control\Windows key, ShutdownTime value
ControlSet001\Control\Windows
LastWrite Time Sat Sep 12 18:10:57 2015 (UTC)
  ShutdownTime = Sat Sep 12 18:10:57 2015 (UTC)
 
shutdowncount v.20080709
(System) Retrieves ShutDownCount value

ControlSet001\Control\Watchdog\Display not found.
......................................................................................................... 
 
timezone v.20160318
(System) Get TimeZoneInformation key contents

TimeZoneInformation key
ControlSet001\Control\TimeZoneInformation
LastWrite Time Mon Aug 24 07:50:29 2015 (UTC)
  DaylightName   -> @tzres.dll,-211
  StandardName   -> @tzres.dll,-212
  Bias           -> 480 (8 hours)
  ActiveTimeBias -> 420 (7 hours)
  TimeZoneKeyName-> Pacific Standard Time
......................................................................................................... 
 
auditpol v.20190510
(Security) Get audit policy from the Security hive file

auditpol
Policy\PolAdtEv
LastWrite Time Sat Jan 19 11:35:18 2008 (UTC)

Data Length: 0x88
0x00000000: 00 01 00 00 09 00 1f 00 76 00 00 00 01 00 00 00  ........v.......
0x00000010: 03 00 00 00 03 00 03 00 01 00 01 00 00 00 01 00  ................
0x00000020: 00 00 00 00 00 00 03 00 00 00 00 00 00 00 00 00  ................
0x00000030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
0x00000040: 00 00 00 00 00 00 00 00 00 00 00 00 01 00 01 00  ................
0x00000050: 00 00 00 00 00 00 00 00 01 00 01 00 01 00 00 00  ................
0x00000060: 00 00 00 00 01 00 00 00 00 00 00 00 01 00 01 00  ................
0x00000070: 00 00 01 00 00 00 05 00 09 00 0b 00 03 00 04 00  ................
0x00000080: 06 00 06 00 04 00 04 00                          ........
......................................................................................................... 
 
disablelastaccess v.20181207
(System) Get NTFSDisableLastAccessUpdate value

NtfsDisableLastAccessUpdate
ControlSet001\Control\FileSystem
NtfsDisableLastAccessUpdate = 0x00000001
 
========================================================================================================= 
User Account Information 
========================================================================================================= 
 
samparse v.20160203
(SAM) Parse SAM file for user & group mbrshp info


User Information
-------------------------
Username        : Administrator [500]
SID             : S-1-5-21-3848053756-3249532031-1848221756-500
Full Name       : 
User Comment    : Built-in account for administering the computer/domain
Account Type    : Default Admin User
Account Created : Mon Aug 24 06:54:25 2015 Z
Name            :  
Last Login Date : Sat Sep 12 18:19:18 2015 Z
Pwd Reset Date  : Mon Aug 24 06:59:37 2015 Z
Pwd Fail Date   : Wed Sep  2 09:00:39 2015 Z
Login Count     : 23
  --> Normal user account

Username        : Guest [501]
SID             : S-1-5-21-3848053756-3249532031-1848221756-501
Full Name       : 
User Comment    : Built-in account for guest access to the computer/domain
Account Type    : Default Guest Acct
Account Created : Mon Aug 24 06:54:25 2015 Z
Name            :  
Last Login Date : Never
Pwd Reset Date  : Never
Pwd Fail Date   : Never
Login Count     : 0
  --> Password does not expire
  --> Account Disabled
  --> Password not required
  --> Normal user account

Username        : user1 [1005]
SID             : S-1-5-21-3848053756-3249532031-1848221756-1005
Full Name       : 
User Comment    : 
Account Type    : Custom Limited Acct
Account Created : Wed Sep  2 09:05:06 2015 Z
Name            :  
Last Login Date : Never
Pwd Reset Date  : Wed Sep  2 09:05:06 2015 Z
Pwd Fail Date   : Never
Login Count     : 0
  --> Normal user account

Username        : hacker [1006]
SID             : S-1-5-21-3848053756-3249532031-1848221756-1006
Full Name       : 
User Comment    : 
Account Type    : Custom Limited Acct
Account Created : Wed Sep  2 09:05:25 2015 Z
Name            :  
Last Login Date : Never
Pwd Reset Date  : Wed Sep  2 09:05:25 2015 Z
Pwd Fail Date   : Never
Login Count     : 0
  --> Normal user account

-------------------------
Group Membership Information
-------------------------
Group Name    : Print Operators [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members can administer domain printers
Users         : None

Group Name    : Users [4]
LastWrite     : Wed Sep  2 09:05:25 2015 Z
Group Comment : Users are prevented from making accidental or intentional system-wide changes and can run most applications
Users :
  S-1-5-21-3848053756-3249532031-1848221756-1005
  S-1-5-4
  S-1-5-11
  S-1-5-21-3848053756-3249532031-1848221756-1006

Group Name    : Event Log Readers [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members of this group can read event logs from local machine
Users         : None

Group Name    : Guests [1]
LastWrite     : Mon Aug 24 06:50:38 2015 Z
Group Comment : Guests have the same access as members of the Users group by default, except for the Guest account which is further restricted
Users :
  S-1-5-21-3848053756-3249532031-1848221756-501

Group Name    : Distributed COM Users [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members are allowed to launch, activate and use Distributed COM objects on this machine.
Users         : None

Group Name    : Administrators [1]
LastWrite     : Mon Aug 24 06:50:38 2015 Z
Group Comment : Administrators have complete and unrestricted access to the computer/domain
Users :
  S-1-5-21-3848053756-3249532031-1848221756-500

Group Name    : Network Configuration Operators [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members in this group can have some administrative privileges to manage configuration of networking features
Users         : None

Group Name    : Cryptographic Operators [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members are authorized to perform cryptographic operations.
Users         : None

Group Name    : Power Users [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Power Users are included for backwards compatibility and possess limited administrative powers
Users         : None

Group Name    : Performance Log Users [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members of this group may schedule logging of performance counters, enable trace providers, and collect event traces both locally and via remote access to this computer
Users         : None

Group Name    : Replicator [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Supports file replication in a domain
Users         : None

Group Name    : Performance Monitor Users [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members of this group can access performance counter data locally and remotely
Users         : None

Group Name    : Remote Desktop Users [2]
LastWrite     : Wed Sep  2 09:19:24 2015 Z
Group Comment : Members in this group are granted the right to logon remotely
Users :
  S-1-5-21-3848053756-3249532031-1848221756-1005
  S-1-5-21-3848053756-3249532031-1848221756-1006

Group Name    : IIS_IUSRS [0]
LastWrite     : Sun Aug 23 21:25:59 2015 Z
Group Comment : Built-in group used by Internet Information Services.
Users         : None

Group Name    : Backup Operators [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Backup Operators can override security restrictions for the sole purpose of backing up or restoring files
Users         : None

Group Name    : Certificate Service DCOM Access [0]
LastWrite     : Sat Jan 19 11:35:23 2008 Z
Group Comment : Members of this group are allowed to connect to Certification Authorities in the enterprise
Users         : None

Analysis Tips:
 - For well-known SIDs, see http://support.microsoft.com/kb/243330
     - S-1-5-4  = Interactive
     - S-1-5-11 = Authenticated Users
 - Correlate the user SIDs to the output of the ProfileList plugin

......................................................................................................... 
 
profilelist v.20100219
(Software) Get content of ProfileList key

Microsoft\Windows NT\CurrentVersion\ProfileList
LastWrite Time Mon Aug 24 06:57:38 2015 (UTC)

Path      : %systemroot%\system32\config\systemprofile
SID       : S-1-5-18
LastWrite : Sat Jan 19 11:40:26 2008 (UTC)

Path      : %SystemRoot%\ServiceProfiles\LocalService
SID       : S-1-5-19
LastWrite : Sat Jan 19 11:40:26 2008 (UTC)

Path      : %SystemRoot%\ServiceProfiles\NetworkService
SID       : S-1-5-20
LastWrite : Sat Jan 19 11:40:26 2008 (UTC)

Path      : C:\Users\Administrator
SID       : S-1-5-21-3848053756-3249532031-1848221756-500
LastWrite : Sat Sep 12 18:19:20 2015 (UTC)
LoadTime  : Thu Jan  1 00:00:00 1970 (UTC)

Domain Accounts
......................................................................................................... 
 
logonusername v.20080324
(NTUSER.DAT) Get user's Logon User Name value

Logon User Name
Software\Microsoft\Windows\CurrentVersion\Explorer
LastWrite Time [Sat Sep 12 18:19:23 2015 (UTC)]
......................................................................................................... 
 
winlogon v.20130425
(Software) Get values from the WinLogon key

Microsoft\Windows NT\CurrentVersion\Winlogon
LastWrite Time Sat Sep 12 18:18:29 2015 (UTC)
  LegalNoticeCaption = 
  LegalNoticeText = 
  ReportBootOk = 1
  AutoRestartShell = 1
  PowerdownAfterShutdown = 0
  ShutdownWithoutLogon = 0
  forceunlocklogon = 0
  WinStationsDisabled = 0
  DisableCAD = 1
  scremoveoption = 0
  cachedlogonscount = 25
  passwordexpirywarning = 14
  DebugServerCommand = no
  ShutdownFlags = 43
  Background = 0 0 0
  Shell = explorer.exe
  Userinit = C:\Windows\system32\userinit.exe,
  VmApplet = rundll32 shell32,Control_RunDLL "sysdm.cpl"

Notify subkey not found.

Wow6432Node\Microsoft\Windows NT\CurrentVersion\Winlogon not found.

Analysis Tips: The UserInit and Shell values are executed when a user logs on.
The UserInit value should contain a reference to userinit.exe; the Shell value
should contain just 'explorer.exe'. Check TaskMan & System values, if found.

Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList not found.
 
========================================================================================================= 
Software Information 
========================================================================================================= 
 
uninstall v.20140512
(Software, NTUSER.DAT) Gets contents of Uninstall keys from Software, NTUSER.DAT hives

Uninstall
Microsoft\Windows\CurrentVersion\Uninstall

Mon Aug 24 07:14:15 2015 (UTC)
  Oracle VM VirtualBox Guest Additions 4.3.30 v.4.3.30.0

Sun Aug 23 21:44:08 2015 (UTC)
  XAMPP v.5.6.11-1

Sun Aug 23 21:43:54 2015 (UTC)
  Microsoft Visual C++ 2008 Redistributable - x86 9.0.21022 v.9.0.21022

Sat Jan 19 11:40:26 2008 (UTC)
  AddressBook
  Connection Manager
  DirectDrawEx
  Fontcore
  IE40
  IE4Data
  IE5BAKEX
  IEData
  MobileOptionPack
  SchedulingAgent

......................................................................................................... 
 
apppaths v.20120524
(Software) Gets content of App Paths subkeys

App Paths
Microsoft\Windows\CurrentVersion\App Paths

Mon Aug 24 07:49:59 2015 (UTC)
  cmmgr32.exe - 
  IEXPLORE.EXE - C:\Program Files\Internet Explorer\IEXPLORE.EXE
Sat Jan 19 11:40:26 2008 (UTC)
  install.exe - 
  pbrush.exe - %SystemRoot%\System32\mspaint.exe
  setup.exe - 
  table30.exe - 
  wab.exe - %ProgramFiles%\Windows Mail\wab.exe
  wabmig.exe - %ProgramFiles%\Windows Mail\wabmig.exe
  WORDPAD.EXE - "%ProgramFiles%\Windows NT\Accessories\WORDPAD.EXE"
  WRITE.EXE - "%ProgramFiles%\Windows NT\Accessories\WORDPAD.EXE"
Wow6432Node\Microsoft\Windows\CurrentVersion\App Paths not found.
......................................................................................................... 
 
product v.20100325
(Software) Get installed product info


Microsoft\Windows\CurrentVersion\Installer\UserData

S-1-5-18
Sun Aug 23 21:43:54 2015 Z
  Microsoft Visual C++ 2008 Redistributable - x86 9.0.21022 v.9.0.21022, 20150823

......................................................................................................... 
 
defbrowser v.20091116
(Software) Gets default browser setting from HKLM

Default Browser Check #1
Clients\StartMenuInternet
LastWrite Time Sat Jan 19 08:55:40 2008 (UTC)

Default Browser : IEXPLORE.EXE

Default Browser Check #2
Classes\HTTP\shell\open\command
LastWrite Time Mon Aug 24 07:49:58 2015 (UTC)

Default Browser = "C:\Program Files\Internet Explorer\iexplore.exe" -nohome
......................................................................................................... 
 
listsoft v.20080324
(NTUSER.DAT) Lists contents of user's Software key

listsoft v.20080324
List the contents of the Software key in the NTUSER.DAT hive
file, in order by LastWrite time.

Sat Sep 12 18:20:08 2015Z 	AccessData
Mon Aug 24 06:57:45 2015Z 	AppDataLow
Mon Aug 24 06:57:39 2015Z 	Policies
Sun Aug 23 10:31:30 2015Z 	Microsoft
......................................................................................................... 
 
UserAssist
Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist
LastWrite Time Mon Aug 24 07:01:10 2015 (UTC)

{0D6D4F41-2994-4BA0-8FEF-620E43CD2812}

Value names with no time stamps:

{5E6AB780-7743-11CF-A12B-00AA004AE837}

Value names with no time stamps:

{75048700-EF1F-11D0-9888-006097DEACF9}
Sat Sep 12 18:19:46 2015 Z
  UEME_RUNPATH (27)
  UEME_RUNPATH:E:\FTK-Imager\FTK Imager.exe (1)
Thu Sep  3 10:03:37 2015 Z
  UEME_RUNPATH:\\Vboxsvr\101\FTK-Imager\FTK Imager.exe (1)
Thu Sep  3 10:03:08 2015 Z
  UEME_RUNPIDL (7)
  UEME_RUNPIDL:%csidl23%\XAMPP\XAMPP Control Panel.lnk (3)
  UEME_RUNPIDL:%csidl23%\XAMPP (1)
  UEME_RUNPIDL:%csidl23% (1)
Thu Sep  3 07:20:06 2015 Z
  UEME_RUNPIDL:%csidl23%\Accessories\Wordpad.lnk (1)
Thu Sep  3 07:19:54 2015 Z
  UEME_RUNPATH:C:\Windows\system32\rundll32.exe (2)
Thu Sep  3 07:19:49 2015 Z
  UEME_RUNPATH:C:\Windows\system32\NOTEPAD.EXE (14)
Wed Sep  2 09:28:30 2015 Z
  UEME_RUNPATH:C:\Windows\System32\cmd.exe (1)
Wed Sep  2 09:01:02 2015 Z
  UEME_RUNPATH:C:\Windows\system32\CompMgmtLauncher.exe (1)
Mon Aug 24 07:13:41 2015 Z
  UEME_RUNPATH:D:\VBoxWindowsAdditions.exe (1)
Mon Aug 24 07:00:06 2015 Z
  UEME_RUNPIDL:%csidl2%\Internet Explorer.lnk (21)
  UEME_RUNPATH:C:\Program Files\Internet Explorer\iexplore.exe (1)
Mon Aug 24 06:58:39 2015 Z
  UEME_RUNPATH:C:\Windows\system32\control.exe (1)
Mon Aug 24 06:56:02 2015 Z
  UEME_RUNPIDL:C:\ProgramData\Microsoft\Windows\Start Menu\Windows Update.lnk (21)
  UEME_RUNPIDL:%csidl2%\Accessories\Notepad.lnk (19)
Sun Aug 23 21:40:21 2015 Z
  UEME_RUNPATH:C:\Users\Administrator\Desktop\xampp-win32-5.6.11-1-VC11-installer.exe (1)
Sun Aug 23 10:33:22 2015 Z
  UEME_RUNPATH:C:\Windows\system32\mspaint.exe (1)
Sun Aug 23 10:32:17 2015 Z
  UEME_RUNPATH:C:\xampp\xampp-control.exe (2)

Value names with no time stamps:
  HRZR_PGYPHNPbhag:pgbe

......................................................................................................... 
 
muicache v.20130425
(NTUSER.DAT,USRCLASS.DAT) Gets EXEs from user's MUICache key

Software\Microsoft\Windows\ShellNoRoam\MUICache not found.

Local Settings\Software\Microsoft\Windows\Shell\MUICache not found.
 
========================================================================================================= 
Networking Information 
========================================================================================================= 
 
compname v.20090727
(System) Gets ComputerName and Hostname values from System hive

ComputerName    = WIN-L0ZZQ76PMUF
TCP/IP Hostname = WIN-L0ZZQ76PMUF
......................................................................................................... 
 
shares v.20140730
(System) Get list of shares from System hive file

 subkey not found.
......................................................................................................... 
 
routes v.20100817
(System) Get persistent routes

ControlSet001\Services\Tcpip\Parameters\PersistentRoutes
LastWrite: Sat Jan 19 11:40:19 2008

ControlSet001\Services\Tcpip\Parameters\PersistentRoutes has no values.
......................................................................................................... 
 
fw_config v.20080328
(System) Gets the Windows Firewall config from the System hive

Windows Firewall Configuration
ControlSet001\Services\SharedAccess\Parameters\FirewallPolicy\DomainProfile
LastWrite Time Sat Jan 19 11:37:29 2008 (UTC)
	EnableFirewall -> 1
	DisableNotifications -> 1

Windows Firewall Configuration
ControlSet001\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile
LastWrite Time Sat Jan 19 11:37:29 2008 (UTC)
	EnableFirewall -> 1
	DisableNotifications -> 1

......................................................................................................... 
 
network v.20080324
(System) Gets info from System\Control\Network GUIDs

Network key
ControlSet001\Control\Network\{4D36E972-E325-11CE-BFC1-08002BE10318}
Interface {03B5F21A-0AFD-491D-BDC5-CBC41C819F98}
LastWrite time Sat Jan 19 11:37:59 2008 (UTC)
	Name              = Local Area Connection* 5
	PnpInstanceID     = 
	MediaSubType      = 

Interface {2861ED8B-87C9-4D7E-902C-179E4F5A1419}
LastWrite time Sat Jan 19 11:37:49 2008 (UTC)
	Name              = Local Area Connection*
	PnpInstanceID     = 
	MediaSubType      = 

Interface {36C218F8-6A46-4C81-B562-E0752F41529C}
LastWrite time Sat Jan 19 11:38:00 2008 (UTC)
	Name              = Local Area Connection* 6
	PnpInstanceID     = 
	MediaSubType      = 

Interface {504988FA-7387-4598-81D7-6663A1980894}
LastWrite time Sat Jan 19 11:37:58 2008 (UTC)
	Name              = Local Area Connection* 4
	PnpInstanceID     = 
	MediaSubType      = 

Interface {526CB437-29AE-4E85-90D7-74CE6B4294D3}
LastWrite time Sat Jan 19 11:40:21 2008 (UTC)
	Name              = Local Area Connection* 7
	PnpInstanceID     = 
	MediaSubType      = 

Interface {999DE783-0855-484F-AFB3-DD859E2D989B}
LastWrite time Wed Sep  2 06:01:49 2015 (UTC)
	Name              = Local Area Connection* 8
	PnpInstanceID     = 
	MediaSubType      = 

Interface {AEDC85EC-EC93-4BB1-B28D-B48708FE8B71}
LastWrite time Mon Aug 24 06:58:19 2015 (UTC)
	Name              = Local Area Connection
	PnpInstanceID     = PCI\VEN_8086&DEV_100E&SUBSYS_001E8086&REV_02\3&267A616A&0&18
	MediaSubType      = 

Interface {B6DB2E69-1FA0-4707-A6DA-F4ABA95DC683}
LastWrite time Sat Jan 19 11:37:57 2008 (UTC)
	Name              = Local Area Connection* 2
	PnpInstanceID     = 
	MediaSubType      = 

Interface {CAC639D8-FDCA-4ECB-A6A3-2D8FA656CEBE}
LastWrite time Sat Jan 19 11:48:13 2008 (UTC)
	Name              = Local Area Connection* 10
	PnpInstanceID     = 
	MediaSubType      = 

Interface {FB1DC09D-55AA-410A-8DE1-0EDA5AFB7361}
LastWrite time Sat Jan 19 11:37:57 2008 (UTC)
	Name              = Local Area Connection* 3
	PnpInstanceID     = 
	MediaSubType      = 

......................................................................................................... 
 
compdesc v.20080324
(NTUSER.DAT) Gets contents of user's ComputerDescriptions key

Software\Microsoft\Windows\CurrentVersion\Explorer\ComputerDescriptions not found.
 
========================================================================================================= 
Storage Locations Information 
========================================================================================================= 
 

mountdev2 v.20140721
(System) Return contents of System hive MountedDevices key

MountedDevices
LastWrite time = Mon Aug 24 06:50:35 2015Z

Volume                                              Disk Sig                            Offset
-------                                             --------                          --------
\??\Volume{6a5c1829-4a2c-11e5-9f92-806e6f6e6963}     ce 12 a6 ca                             0
\DosDevices\C:                                       ce 12 a6 ca                             0

\??\Volume{6a5c1829-4a2c-11e5-9f92-806e6f6e6963}
  Mon Aug 24 06:50:32 2015

Device: \??\IDE#CdRomVBOX_CD-ROM_____________________________1.0_____#5&106af171&0&1.0.0#{53f5630d-b6bf-11d0-94f2-00a0c91efb8b}
  \??\Volume{6a5c182c-4a2c-11e5-9f92-806e6f6e6963}
  \DosDevices\D:


Unique MAC Addresses:
80:6E:6F:6E:69:63
......................................................................................................... 
 
shellfolders v.20090115
(NTUSER.DAT) Retrieve user Shell Folders values

Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
LastWrite Time Mon Aug 24 06:57:48 2015 (UTC)
!Do not use this registry key Use the SHGetFolderPath or SHGetKnownFolderPath function instead
Local AppData        C:\Users\Administrator\AppData\Local    
My Video             C:\Users\Administrator\Videos           
AppData              C:\Users\Administrator\AppData\Roaming  
My Pictures          C:\Users\Administrator\Pictures         
Desktop              C:\Users\Administrator\Desktop          
History              C:\Users\Administrator\AppData\Local\Microsoft\Windows\History
NetHood              C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Network Shortcuts
Cookies              C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Cookies
Favorites            C:\Users\Administrator\Favorites        
SendTo               C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\SendTo
Start Menu           C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu
My Music             C:\Users\Administrator\Music            
Programs             C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs
Recent               C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent
CD Burning           C:\Users\Administrator\AppData\Local\Microsoft\Windows\Burn\Burn
PrintHood            C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Printer Shortcuts
Startup              C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
Administrative Tools C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Administrative Tools
Personal             C:\Users\Administrator\Documents        
Cache                C:\Users\Administrator\AppData\Local\Microsoft\Windows\Temporary Internet Files
Templates            C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Templates
Fonts                C:\Windows\Fonts                        

......................................................................................................... 
 
mndmru v.20080324
(NTUSER.DAT) Get contents of user's Map Network Drive MRU

Map Network Drive MRU
Software\Microsoft\Windows\CurrentVersion\Explorer\Map Network Drive MRU
LastWrite Time Mon Aug 24 07:10:53 2015 (UTC)
Software\Microsoft\Windows\CurrentVersion\Explorer\Map Network Drive MRU has no values.
......................................................................................................... 
 
mp2 v.20120330
(NTUSER.DAT) Gets user's MountPoints2 key contents

MountPoints2
Software\Microsoft\Windows\CurrentVersion\Explorer\MountPoints2
LastWrite Time Sat Sep 12 18:19:29 2015 (UTC)

Remote Drives:
Sat Sep 12 18:19:29 2015 (UTC)
  ##vboxsrv#Desktop
Sun Aug 23 21:17:42 2015 (UTC)
  ##vboxsrv#temp

Volumes:
Mon Aug 24 07:13:37 2015 (UTC)
  {6a5c182c-4a2c-11e5-9f92-806e6f6e6963}
Mon Aug 24 06:57:44 2015 (UTC)
  {6a5c1829-4a2c-11e5-9f92-806e6f6e6963}

Drives:
Mon Aug 24 06:57:44 2015 (UTC) - CPC

Unique MAC Addresses:
80:6E:6F:6E:69:63

Analysis Tip: Correlate the Volume entries to those found in the MountedDevices
entries that begin with "\??\Volume".
```
**Gathering Information from Memory**

We can use this [Volatility Command Reference](https://github.com/volatilityfoundation/volatility/wiki/Command-Reference).

- Image Info
```
python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem imageinfo
```
*( Windows2008Sp1)*
 - Process List
```
python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 pslist
```
*( xampp installed )*
 - Connection Scan
```
python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 netscan
```
*( 80/443 for apache server )*
*( 3306 for mysql server )*

 - Consoles
```
D:\Web Server Case>python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 consoles
Volatility Foundation Volatility Framework 2.6.1
**************************************************
ConsoleProcess: csrss.exe Pid: 484
Console: 0xef4944 CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: taskeng.exe
Title: -
**************************************************
ConsoleProcess: csrss.exe Pid: 484
Console: 0xef65ec CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: C:\Windows\system32\schtasks.exe
Title: -
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0xe90da4 CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: 
Title: -
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0xe9143c CommandHistorySize: 50
HistoryBufferCount: 2 HistoryBufferMax: 4
OriginalTitle: Administrator: Command Prompt
Title: -
AttachedProcess: cmd.exe Pid: 1972 Handle: 0x7ec
----
CommandHistory: 0x5a17c30 Application: netsh.exe Flags:
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x0
----
CommandHistory: 0x5a30950 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 2 LastAdded: 1 LastDisplayed: 1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x7ec
Cmd #0 at 0xe91970: netsh fireall set service type=remotedesktop mode=enable scope=subnet
Cmd #1 at 0x5a17b58: netsh firewall set service type=remotedesktop mode=enable scope=subnet
----
Screen 0xe91738 X:80 Y:300
Dump:
Microsoft Windows [Version 6.0.6001]
Copyright (c) 2006 Microsoft Corporation.  All rights reserved.

C:\Users\Administrator>netsh fireall set service type=remotedesktop mode=enable
scope=subnet
The following command was not found: fireall set service type=remotedesktop mode
=enable scope=subnet.

C:\Users\Administrator>netsh firewall set service type=remotedesktop mode=enable
 scope=subnet
Ok.


C:\Users\Administrator>
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0xe91b04 CommandHistorySize: 50
HistoryBufferCount: 4 HistoryBufferMax: 4
OriginalTitle: Administrator: Command Prompt
Title: -
AttachedProcess: cmd.exe Pid: 612 Handle: 0x2d8
----
CommandHistory: 0x5a248a8 Application: netsh.exe Flags:
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x0
----
CommandHistory: 0x5a34dc0 Application: net1.exe Flags:
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x0
----
CommandHistory: 0x5a34c90 Application: net.exe Flags:
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x0
----
CommandHistory: 0x5a24708 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 17 LastAdded: 16 LastDisplayed: 16
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x2d8
Cmd #0 at 0xe907c8: ipconfig
Cmd #1 at 0xe91af8: cls
Cmd #2 at 0xe91db0: ipconfig
Cmd #3 at 0x5a34bd0: net user user1 user1 /add
Cmd #4 at 0x5a34eb8: net user user1 root@psut /add
Cmd #5 at 0x5a34c10: net user user1 Root@psut /add
Cmd #6 at 0x5a24800: cls
Cmd #7 at 0x5a34c58: net /?
Cmd #8 at 0x5a34d88: net localgroup /?
Cmd #9 at 0x5a34f48: net localgroup "Remote Desktop Users" user1 /add
Cmd #10 at 0x5a34c70: net /?
Cmd #11 at 0xe911b0: netsh /?
Cmd #12 at 0xe907e8: netsh firewall /?
Cmd #13 at 0xe91218: netsh firewall set service type = remotedesktop /?
Cmd #14 at 0xe91288: netsh firewall set service type = remotedesktop enable
Cmd #15 at 0xe91300: netsh firewall set service type=remotedesktop mode=enable
Cmd #16 at 0xe91380: netsh firewall set service type=remotedesktop mode=enable scope=subnet
----
Screen 0xe91e00 X:80 Y:300
Dump:

C:\Users\Administrator>net /?
The syntax of this command is:

NET
    [ ACCOUNTS | COMPUTER | CONFIG | CONTINUE | FILE | GROUP | HELP |
      HELPMSG | LOCALGROUP | PAUSE | PRINT | SESSION | SHARE | START |
      STATISTICS | STOP | TIME | USE | USER | VIEW ]

C:\Users\Administrator>net localgroup /?
The syntax of this command is:

NET LOCALGROUP
[groupname [/COMMENT:"text"]] [/DOMAIN]
              groupname {/ADD [/COMMENT:"text"] | /DELETE}  [/DOMAIN]
              groupname name [...] {/ADD | /DELETE} [/DOMAIN]


C:\Users\Administrator>net localgroup "Remote Desktop Users" user1 /add
The command completed successfully.


C:\Users\Administrator>net /?
The syntax of this command is:

NET
    [ ACCOUNTS | COMPUTER | CONFIG | CONTINUE | FILE | GROUP | HELP |
      HELPMSG | LOCALGROUP | PAUSE | PRINT | SESSION | SHARE | START |
      STATISTICS | STOP | TIME | USE | USER | VIEW ]

C:\Users\Administrator>netsh /?

Usage: netsh [-a AliasFile] [-c Context] [-r RemoteMachine] [-u [DomainName\]Use
rName] [-p Password | *]
             [Command | -f ScriptFile]

The following commands are available:

Commands in this context:
?              - Displays a list of commands.
add            - Adds a configuration entry to a list of entries.
advfirewall    - Changes to the `netsh advfirewall' context.
bridge         - Changes to the `netsh bridge' context.
delete         - Deletes a configuration entry from a list of entries.
dhcpclient     - Changes to the `netsh dhcpclient' context.
dump           - Displays a configuration script.
exec           - Runs a script file.
firewall       - Changes to the `netsh firewall' context.
help           - Displays a list of commands.
http           - Changes to the `netsh http' context.
interface      - Changes to the `netsh interface' context.
ipsec          - Changes to the `netsh ipsec' context.
lan            - Changes to the `netsh lan' context.
nap            - Changes to the `netsh nap' context.
netio          - Changes to the `netsh netio' context.
ras            - Changes to the `netsh ras' context.
rpc            - Changes to the `netsh rpc' context.
set            - Updates configuration settings.
show           - Displays information.
winhttp        - Changes to the `netsh winhttp' context.
winsock        - Changes to the `netsh winsock' context.

The following sub-contexts are available:
 advfirewall bridge dhcpclient firewall http interface ipsec lan nap netio ras r
pc winhttp winsock

To view help for a command, type the command, followed by a space, and then
 type ?.

C:\Users\Administrator>netsh firewall /?

The following commands are available:

Commands in this context:
?              - Displays a list of commands.
add            - Adds firewall configuration.
delete         - Deletes firewall configuration.
dump           - Displays a configuration script.
help           - Displays a list of commands.
reset          - Resets firewall configuration to default.
set            - Sets firewall configuration.
show           - Shows firewall configuration.

To view help for a command, type the command, followed by a space, and then
 type ?.


C:\Users\Administrator>netsh firewall set service type = remotedesktop /?
The syntax supplied for this command is not valid. Check help for the correct sy
ntax.

set service
      [ type = ] FILEANDPRINT|REMOTEADMIN|REMOTEDESKTOP|UPNP|ALL
      [ [ mode = ] ENABLE|DISABLE
        [ scope = ] ALL|SUBNET|CUSTOM
        [ addresses = ] addresses
        [ profile = ] CURRENT|DOMAIN|STANDARD|ALL ]

  Sets firewall service configuration.

  Parameters:

  type - Service type.
      FILEANDPRINT  - File and printer sharing.
      REMOTEADMIN   - Remote administration.
      REMOTEDESKTOP - Remote assistance and remote desktop.
      UPNP          - UPnP framework.
      ALL           - All types.

  mode - Service mode (optional).
      ENABLE  - Allow through firewall (default).
      DISABLE - Do not allow through firewall.

  scope - Service scope (optional).
      ALL    - Allow all traffic through firewall.
      SUBNET - Allow only local network (subnet) traffic through firewall.
      CUSTOM - Allow only specified traffic through firewall.

  addresses - Custom scope addresses (optional).
              This comma-separated scope can contain IPv4 addresses,
              IPv6 addresses, subnets, ranges, or the keyword LocalSubnet.

  profile - Configuration profile (optional).
      CURRENT  - Applies to the active profile.  Active profile can be domain,
                 standard (i.e. private), or public. (default).
      DOMAIN   - Applies to the domain profile.
      STANDARD - Applies to the standard (i.e. private) profile.
      ALL      - Applies to the domain and standard (i.e. private) profile.
                 Does not apply to the public profile.

  Remarks: 'scope' must be 'CUSTOM' to specify 'addresses'.
           `addresses' can not contain Unspecified or Loopback addresses.

  Examples:

      set service FILEANDPRINT
      set service REMOTEADMIN DISABLE
      set service REMOTEDESKTOP ENABLE CUSTOM
          157.60.0.1,172.16.0.0/16,10.0.0.0/255.0.0.0,
          12AB:0000:0000:CD30::/60,LocalSubnet
      set service type=UPNP
      set service type=REMOTEADMIN mode=ENABLE scope=SUBNET
      set service type=REMOTEDESKTOP mode=ENABLE scope=CUSTOM
          addresses=157.60.0.1,172.16.0.0/16,10.0.0.0/255.0.0.0,
          12AB:0000:0000:CD30::/60,LocalSubnet


C:\Users\Administrator>netsh firewall set service type = remotedesktop enable
Ok.


C:\Users\Administrator>netsh firewall set service type=remotedesktop mode=enable

Ok.


C:\Users\Administrator>netsh firewall set service type=remotedesktop mode=enable
 scope=subnet
Ok.


C:\Users\Administrator>
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0x5a17d24 CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: ????
Title: -
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0x5a18124 CommandHistorySize: 50
HistoryBufferCount: 2 HistoryBufferMax: 4
OriginalTitle: Administrator: C:\Windows\system32\cmd.exe
Title: -
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0x5a24a0c CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: c:\xampp\apache\bin\httpd.exe
Title: -
AttachedProcess: httpd.exe Pid: 2796 Handle: 0x3bc
----
CommandHistory: 0x5a30ad0 Application: httpd.exe Flags: Allocated
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x3bc
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0x5a34c1c CommandHistorySize: 50
HistoryBufferCount: 4 HistoryBufferMax: 4
OriginalTitle: r user1 root@psut /add???????????
Title: -
**************************************************
ConsoleProcess: csrss.exe Pid: 524
Console: 0x5a3f83c CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: ????
Title: -
```
*( Added New users )*
*( Remote Desktop Protocol and Firewall )*

 - Cmdscan
```
D:\Web Server Case>python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 cmdscan
Volatility Foundation Volatility Framework 2.6.1
**************************************************
CommandProcess: csrss.exe Pid: 524
CommandHistory: 0x5a24708 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 17 LastAdded: 16 LastDisplayed: 16
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x2d8
Cmd #0 @ 0xe907c8: ipconfig
Cmd #1 @ 0xe91af8: cls
Cmd #2 @ 0xe91db0: ipconfig
Cmd #3 @ 0x5a34bd0: net user user1 user1 /add
Cmd #4 @ 0x5a34eb8: net user user1 root@psut /add
Cmd #5 @ 0x5a34c10: net user user1 Root@psut /add
Cmd #6 @ 0x5a24800: cls
Cmd #7 @ 0x5a34c58: net /?
Cmd #8 @ 0x5a34d88: net localgroup /?
Cmd #9 @ 0x5a34f48: net localgroup "Remote Desktop Users" user1 /add
Cmd #10 @ 0x5a34c70: net /?
Cmd #11 @ 0xe911b0: netsh /?
Cmd #12 @ 0xe907e8: netsh firewall /?
Cmd #13 @ 0xe91218: netsh firewall set service type = remotedesktop /?
Cmd #14 @ 0xe91288: netsh firewall set service type = remotedesktop enable
Cmd #15 @ 0xe91300: netsh firewall set service type=remotedesktop mode=enable
Cmd #16 @ 0xe91380: netsh firewall set service type=remotedesktop mode=enable scope=subnet
**************************************************
CommandProcess: csrss.exe Pid: 524
CommandHistory: 0x5a30950 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 2 LastAdded: 1 LastDisplayed: 1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x7ec
Cmd #0 @ 0xe91970: netsh fireall set service type=remotedesktop mode=enable scope=subnet
Cmd #1 @ 0x5a17b58: netsh firewall set service type=remotedesktop mode=enable scope=subnet
Cmd #38 @ 0x5a30bc8:
Cmd #39 @ 0x5a24890: et.exe
Cmd #48 @ 0x5a24890: et.exe
Cmd #49 @ 0xe91af8: cls
**************************************************
CommandProcess: csrss.exe Pid: 524
CommandHistory: 0x5a30ad0 Application: httpd.exe Flags: Allocated
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x3bc
```
 - Hive List 
```
D:\Web Server Case>python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 hivelist
Volatility Foundation Volatility Framework 2.6.1
Virtual    Physical   Name
---------- ---------- ----
0x87b4ba20 0x3c0c0a20 \Device\HarddiskVolume1\Windows\System32\config\COMPONENTS
0x87b55a20 0x3c192a20 \Device\HarddiskVolume1\Windows\System32\config\SOFTWARE
0x87b7d008 0x3a6a2008 \Device\HarddiskVolume1\Windows\System32\config\SAM
0x87b7d6a8 0x3a6a26a8 \Device\HarddiskVolume1\Windows\System32\config\DEFAULT
0x8ab1aa20 0x3c285a20 \Device\HarddiskVolume1\Boot\BCD
0x8f4dba20 0x25828a20 \Device\HarddiskVolume1\Windows\ServiceProfiles\NetworkService\NTUSER.DAT
0x8f565a20 0x251eba20 \Device\HarddiskVolume1\Windows\ServiceProfiles\LocalService\NTUSER.DAT
0x90edca20 0x1c1d5a20 \Device\HarddiskVolume1\Users\Administrator\AppData\Local\Microsoft\Windows\UsrClass.dat
0x90f09a20 0x1ab8ea20 \Device\HarddiskVolume1\Users\Administrator\NTUSER.DAT
0x86210008 0x00ac8008 [no name]
0x86226008 0x00a94008 \REGISTRY\MACHINE\SYSTEM
0x86246008 0x00a76008 \REGISTRY\MACHINE\HARDWARE
0x87b17a20 0x3c1f5a20 \Device\HarddiskVolume1\Windows\System32\config\SECURITY
```
 - hashdump
```
D:\Web Server Case>python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 hashdump -y 0x86226008 -s 0x87b7d008
Volatility Foundation Volatility Framework 2.6.1
Administrator:500:aad3b435b51404eeaad3b435b51404ee:63d6a39b8467b94ae92ab1931d4079dd:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
user1:1005:aad3b435b51404eeaad3b435b51404ee:817875ce4794a9262159186413772644:::
hacker:1006:aad3b435b51404eeaad3b435b51404ee:817875ce4794a9262159186413772644:::
```

**Log Analysis**

- Log File Location on XAMPP
```
root@siftworkstation -> /c/Web Server Case
# ls -l /mnt/Web_Server_Case/xampp/apache/logs/
total 1677
-rwxrwxrwx 1 root root 1660806 Sep  3  2015 access.log
-rwxrwxrwx 1 root root    5462 Aug 23  2015 error.log
-rwxrwxrwx 1 root root       6 Aug 23  2015 httpd.pid
-rwxrwxrwx 1 root root    3146 Jul 12  2015 install.log
-rwxrwxrwx 2 root root       0 Aug 23  2015 ssl_request.log
```
- I used [scalp](https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/apache-scalp/scalp-0.4.py) tool for log analysis & [filter](https://raw.githubusercontent.com/PHPIDS/PHPIDS/master/lib/IDS/default_filter.xml) from php-ids
```
root@siftworkstation -> /c/Web Server Case
# python scalp-0.4.py -l /mnt/Web_Server_Case/xampp/apache/logs/access.log -f default_filter.xml -o output --html
The directory %s doesn't exist, scalp will try to create it
Loading XML file 'default_filter.xml'...
Processing the file '/mnt/Web_Server_Case/xampp/apache/logs/access.log'...
Scalp results:
        Processed 7716 lines over 7716
        Found 1667 attack patterns in 3.132797 s
Generating output in output/access.log_scalp_*
```
 - Found Following Attacks
```
XSS
SQLi
LFI
Directory Traversal
```
*( We can notice Data Exfiltration with Directory Traversal )*
```
#Log File
/dvwa/vulnerabilities/fi/?page=../../../../../../users/administrator/data.txt

#Checking
root@siftworkstation -> /c/Web Server Case
# cat /mnt/Web_Server_Case/Users/Administrator/data.txt
hello
```
 - Who is this?
```
root@siftworkstation -> /c/Web Server Case
# grep 'data.txt' /mnt/Web_Server_Case/xampp/apache/logs/access.log
192.168.56.102 - - [02/Sep/2015:02:33:23 -0700] "GET /dvwa/vulnerabilities/fi/?page=../../../../../../users/administrator/data.txt HTTP/1.1" 200 3641 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0"
192.168.56.102 - - [02/Sep/2015:02:36:48 -0700] "GET /dvwa/vulnerabilities/fi/?page=../../../../../../../../users/administrator/data.txt HTTP/1.1" 200 3641 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0"
```
*( IP = 192.168.56.102 )
( OS = Linux )
( Browser = Mozilla Firefox )*

 - What requests made by this IP for DVWA
```
grep 192.168.56.102 /mnt/Web_Server_Case/xampp/apache/logs/access.log | grep dvwa
```

**Viewing apache's public_html**
 - xampp hold applications in htdocs
```
root@siftworkstation -> /c/Web Server Case
# ls -l /mnt/Web_Server_Case/xampp/htdocs/
total 45
-rwxrwxrwx 2 root root  3553 Jul 21  2015 applications.html
-rwxrwxrwx 1 root root   177 Jul 21  2015 bitnami.css
drwxrwxrwx 1 root root  4096 Aug 23  2015 dashboard
drwxrwxrwx 1 root root  4096 Sep  3  2015 DVWA
-rwxrwxrwx 1 root root 30894 Jul 16  2015 favicon.ico
drwxrwxrwx 1 root root     0 Aug 23  2015 img
-rwxrwxrwx 1 root root   260 Jul 16  2015 index.php
drwxrwxrwx 1 root root     0 Aug 23  2015 webalizer
drwxrwxrwx 1 root root     0 Aug 23  2015 xampp
```
In DVWA, some challenges used to HTTP Post Method, thats mean access.log cannot keep this Post request ( *eg. Command Injection , File Upload ,etc... *)

 - This user used Command Injection?
 
```
root@siftworkstation -> /c/Web Server Case
# grep '192.168.56.102' /mnt/Web_Server_Case/xampp/apache/logs/access.log | grep exec
```
 - Example Result
```
192.168.56.102 - - [02/Sep/2015:01:43:29 -0700] "GET /dvwa/vulnerabilities/exec/ HTTP/1.1" 200 4471 "-" "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)"
192.168.56.102 - - [02/Sep/2015:01:43:29 -0700] "GET /dvwa/vulnerabilities/exec/. HTTP/1.1" 200 4471 "http://192.168.56.101/dvwa/index.php" "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)"
```
*( Time = 02/Sep/2015:01:43:29 )*
*( Browsers are not the same for all requests )*

**Source Code Analysis**
- If we have PHP source code, we can spot the vulnerabilities with PHP Security Audit Tool ( i used [rips](http://rips-scanner.sourceforge.net/) )
 - Its need XAMPP server ( [Download](https://www.apachefriends.org/download.html) ) for Windows

```
Start Apache Service & Copy to htdocs

#Access 
http://IP/rips-0.55/

#Put following in Path/Field
F:\xampp\htdocs\DVWA
```

**Any Web Shell?**
 - We can use [Shell-Detector](http://www.shelldetector.com/) for Common PHP Web Shells

```
#Download
wget https://raw.github.com/emposha/Shell-Detector/master/shelldetect.py

#Running
 python shelldetect.py -r True -d /mnt/Web_Server_Case/xampp/htdocs/
 
#Example Output
=======================================================

   Suspicious behavior found in: /mnt/Web_Server_Case/xampp/htdocs/DVWA/c99.php
   Full path:     /mnt/Web_Server_Case/xampp/htdocs/DVWA/c99.php
   Owner:         0:0
   Permission:    777
   Last accessed: Sat Jun  9 21:57:28 2012
   Last modified: Thu Sep  3 07:20:45 2015
   Filesize:      152.5 KB

   Suspicious function used: ['system'](line: 202)
   Suspicious function used: ['eval'](line: 234)
   Suspicious function used: ['exec', 'exec'](line: 468)
   Suspicious function used: ['shell_exec', 'shell_exec'](line: 469)
   Suspicious function used: ['system', 'system'](line: 470)
   Suspicious function used: ['passthru', 'passthru'](line: 471)
   Suspicious function used: ['`$cmd`'](line: 472)
   Suspicious function used: ['popen'](line: 473)
   Suspicious function used: ['base64_decode'](line: 556)
   Suspicious function used: ['`".$tab."`'](line: 612)
   Suspicious function used: ['`".$tab."`'](line: 614)
   Suspicious function used: ['`$tab`'](line: 621)
   Suspicious function used: ['`$tab`', '`".$keys."`'](line: 630)
   Suspicious function used: ['`".$k."`'](line: 664)
   Suspicious function used: ['`".$name."`'](line: 705)
   Suspicious function used: ['`".addslashes($db)."`'](line: 716)
```
**Strings Analysis in Memory**

```
#Export Memory Strings to a text file
strings memdump.mem > memory_strings.txt

#Grep %26%26 for &&
~grep '%26%26' memory_strings.txt 
ip=192.168.56.102+%26%26+dir&submit=submit
ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd&submit=submit$
ip=192.168.56.102+%26%26%64%69%72&submit=submit?
ip=192.168.56.102+%26%26+dir+C%3A%5Cwindows%5C&submit=submit_
P26.102+%26%26+dir+C%3A%5Cusers%5Cadministrator&submit=submit
Zp6.102+%26%26+net+user+hacker+hacker+/add&submit=submit

#grep IP
~grep '192.168.56.102' memory_strings.txt
192.168.56.102 - - [02/Sep/2015:23:59:38 -0700] "GET /tmpbrjvl.php?cmd=del%20%2FF%20%2FQ%20%5Cxampp%5Chtdocs%5Ctmpbrjvl.php HTTP/1.1" 200 11 "-" "sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)
```

**Process Memory Analysis**
 - According to pslist result with volatility, httpd is running with `2796` and `2880` process ids respectively

 - Memory Dump using pid
```
D:\Web Server Case>mkdir Memory_Dumps

D:\Web Server Case>python C:\Users\Luna\Desktop\Misc\volatility\vol.py -f memdump.mem --profile=Win2008SP1x86 memdump -p 2880 -D Memory_Dumps
Volatility Foundation Volatility Framework 2.6.1
************************************************************************
Writing httpd.exe [  2880] to 2880.dmp
```
 - We can search keywords using [this](https://www.dfir.training/keyword-lists)
 - Example Keyword Search 'hacker'
```
root@siftworkstation -> /c/Web Server Case
# strings -a 2880.dmp | grep 'hacker'
~^webwhacker.*$~
WebWhacker*
WebWhacker*
WebWhacker
<center><b>Owned by hacker</b></center>
<center><b>Owned by hacker</b></center>
<center><b>Owned by hacker</b></center>
<center><b>Owned by hacker</b></center>
<center><b>Owned by hacker</b></center>
Zp6.102+%26%26+net+user+hacker+hacker+/add&submit=submit
ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd&submit=submit$
hackerLo
```
 - Example keyword search 'password'
```
root@siftworkstation -> /c/Web Server Case
# strings -a 2880.dmp | grep 'password'
#     Note that no password is obtained from the user. Every entry in the user
#     file needs this password: `xxj31ZMTZzkVA'.
mysql.default_password
password_needs_rehash
password_hash
password_get_info
password_verify
password
```

